import{styleMapped}from"../constant/styleMapped";import{getStyleSwitchCaseResult}from"./getStyleSwitchCaseResult";import{Theme}from"../theme";import generateHashedClass from"./generateComponentId";import{NoScreenError}from"./NoScreenError";import{splitScopeAndClass}from"../constant/splitScopedAndClass";import{scopeAlreadyUsedError}from"./scopeAlreadyUsedError";const styleScopedStore=new Set;function parseStyle(e){var{groups:t,scope:s}=groupStyles(e),r=[],l={},a={},o=[];for(let e=0;e<t.length;++e){var i=t[e];if(i.startsWith("$")){var[n,c]=splitVariable(i),p=c.trim();if(p.startsWith(".")){var u=getScreenResult(n,p,s);for(const d in u)l[d]=u[d]}else p.startsWith("0%")||p.startsWith("from")?(p=getAnimationResult(p.split(";")),r[e]=`@keyframes ${n.slice(1)}{${p}}`):o[e]=getVariableResult(n.slice(1),c)}else{var{className:p,cssProperties:n,hashedClass:c,mergedClass:i,selectorSplitted:m}=getStyleTextFromClass(i,s),m=(a[p]={hashedClass:c,mergedClass:i},m||"");r[e]=`.${i}${m}{${n.join("")}}`}}return{styleResult:r,hashedClasses:a,screenStyleResult:l,cssVariablesResult:o,scope:s}}function splitClassNameAndSelector(e){var t=e.trim().match(/(.*?)([>\s~+]|::|:)(.*)/);return t?[t[1],t[2]+t[3]]:[e]}function getStyleTextFromClass(e,t){var s=[],[e,r]=e.split(": "),[e,l]=splitClassNameAndSelector(e),t=""+t+splitScopeAndClass+e.trim().slice(1),a=r.trim().split(" ");for(let e=0;e<a.length;e++){var o=a[e];s[e]=getStyleResult(o)}e=t+`{${s.join("")}}`,r=generateHashedClass(e);return{cssProperties:s,className:t,hashedClass:r,mergedClass:t+"__"+r,selectorSplitted:l}}function getScreenResult(e,t,s){var r=getThemeScreenValue(e.slice(1)),l=t.split(";"),a={};for(let e=0;e<l.length;e++){var o,i,n,c,p=l[e];p&&({cssProperties:p,className:o,hashedClass:i,mergedClass:n,selectorSplitted:c}=getStyleTextFromClass(p,s),c=`.${o}${c||""}{${p.join("")}}`,a[n]={hashedClass:i,mergedClass:n,cssText:`@media only screen and ${r}{${c}}`,classRef:o})}return a}function getThemeScreenValue(e){return Theme.screen&&Theme.screen[e]||NoScreenError(e),Theme.screen?.[e]}function getStyleValueResult(e){var[t,s,r,l]=e.split("-");return""+getStyleSwitchCaseResult(e,t,s,r,l)}function getStyleResult(e){e=e.replace(";","");if(!e.startsWith("$"))return(styleMapped[e]||getStyleValueResult(e))+";"}function getAnimationResult(t){var s=[];for(let e=0;e<t.length;e++){var r,l=t[e];l&&([l,r]=l.split(": "),s[e]=`${l}{${getStyleResult(r)}}`)}return s.join("")}function getVariableResult(e,t){var[,t]=t.split(":");return`--${e}:`+t}function groupStyles(e){var t=e.split("\n");let s="";var r=[];let l="";for(let e=0;e<t.length;++e){var a=t[e],o=a.trim();o&&!a.startsWith("    ")?o.startsWith("scope")?checkScopeAlreadyUsed(l=o.slice(6).trim().slice(0,-1)):(s&&r.push(s.replace(/\s+$/g,"")),s=o):o&&(s+=" "+o)}return s&&r.push(s.replace(/\s+$/g,"")),{groups:r,scope:l}}function checkScopeAlreadyUsed(e){styleScopedStore.has(e)?scopeAlreadyUsedError(e):styleScopedStore.add(e)}function splitVariable(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+1)]}export{parseStyle};